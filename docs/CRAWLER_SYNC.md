# çˆ¬è™«æ•°æ®åŒæ­¥åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

çˆ¬è™«æ•°æ®åŒæ­¥åŠŸèƒ½å¯ä»¥è‡ªåŠ¨æ£€æµ‹æ–°çš„çˆ¬å–æ•°æ®ï¼Œå¹¶å®æ—¶é€šçŸ¥å•†å“åˆ—è¡¨é¡µé¢åˆ·æ–°ï¼Œç¡®ä¿ç”¨æˆ·å§‹ç»ˆçœ‹åˆ°æœ€æ–°çš„å•†å“ä¿¡æ¯ã€‚

## æ ¸å¿ƒç‰¹æ€§

### 1. è‡ªåŠ¨æ£€æµ‹æ–°æ•°æ®
- æ¯ 10 ç§’è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„çˆ¬å–æ•°æ®
- æ£€æµ‹æœ€è¿‘æ·»åŠ çš„å•†å“
- ç›‘æ§çˆ¬å–æ—¥å¿—çŠ¶æ€

### 2. å®æ—¶é€šçŸ¥æ¨ªå¹…
å½“æ£€æµ‹åˆ°æ–°æ•°æ®æ—¶ï¼Œå•†å“åˆ—è¡¨é¡µé¢ä¼šæ˜¾ç¤ºä¸€ä¸ªç»¿è‰²æ¨ªå¹…ï¼š
```
ğŸ‰ å‘ç° X ä¸ªæ–°å•†å“ï¼
çˆ¬è™«å·²å®Œæˆæ•°æ®é‡‡é›†ï¼Œç‚¹å‡»åˆ·æ–°æŸ¥çœ‹æœ€æ–°å•†å“
[ç«‹å³åˆ·æ–°] [ç¨å]
```

### 3. æ–°å•†å“æ ‡è®°
- 24 å°æ—¶å†…æ·»åŠ çš„å•†å“ä¼šæ˜¾ç¤º "ğŸ†• æ–°å“" æ ‡ç­¾
- æ ‡ç­¾å¸¦æœ‰åŠ¨ç”»æ•ˆæœï¼Œæ›´åŠ é†’ç›®

### 4. è‡ªåŠ¨è·³è½¬
- çˆ¬è™«å®Œæˆåè‡ªåŠ¨è·³è½¬åˆ°å•†å“åˆ—è¡¨
- 2 ç§’å»¶è¿Ÿï¼Œç»™ç”¨æˆ·æŸ¥çœ‹ç»“æœçš„æ—¶é—´

## ä½¿ç”¨æµç¨‹

### æ­¥éª¤ 1: å¯åŠ¨çˆ¬è™«
1. è®¿é—® `/admin/real-crawler`
2. é…ç½®çˆ¬å–å‚æ•°ï¼š
   - é€‰æ‹©å¹³å°ï¼ˆAmazon/AliExpressï¼‰
   - è¾“å…¥æœç´¢å…³é”®è¯
   - è¾“å…¥åˆ†ç±» ID
   - è®¾ç½®çˆ¬å–é¡µæ•°ï¼ˆ1-5ï¼‰
3. ç‚¹å‡»"å¼€å§‹çˆ¬å–"

### æ­¥éª¤ 2: ç­‰å¾…çˆ¬å–å®Œæˆ
- çˆ¬å–è¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºè¿›åº¦
- å®Œæˆåæ˜¾ç¤ºç»“æœç»Ÿè®¡
- 2 ç§’åè‡ªåŠ¨è·³è½¬åˆ°å•†å“åˆ—è¡¨

### æ­¥éª¤ 3: æŸ¥çœ‹æ–°å•†å“
- å•†å“åˆ—è¡¨ä¼šè‡ªåŠ¨æ£€æµ‹æ–°æ•°æ®
- æ˜¾ç¤ºé€šçŸ¥æ¨ªå¹…
- ç‚¹å‡»"ç«‹å³åˆ·æ–°"æŸ¥çœ‹æ–°å•†å“
- æ–°å•†å“å¸¦æœ‰ "ğŸ†• æ–°å“" æ ‡ç­¾

## API æ¥å£

### åŒæ­¥çŠ¶æ€ API
```
GET /api/crawl/sync?since={ISO_TIMESTAMP}
```

**å‚æ•°:**
- `since` (å¯é€‰): ISO æ ¼å¼çš„æ—¶é—´æˆ³ï¼Œåªè¿”å›æ­¤æ—¶é—´ä¹‹åçš„æ•°æ®

**å“åº”:**
```json
{
  "success": true,
  "data": {
    "hasNewData": true,
    "newProductsCount": 15,
    "recentCrawls": [...],
    "recentProducts": [...],
    "timestamp": "2025-10-29T10:30:00.000Z"
  }
}
```

## React Hook

### useCrawlerSync

ç”¨äºåœ¨ç»„ä»¶ä¸­ç›‘å¬çˆ¬è™«æ•°æ®æ›´æ–°ã€‚

**ä½¿ç”¨ç¤ºä¾‹:**
```typescript
import { useCrawlerSync } from '@/hooks/use-crawler-sync';

function MyComponent() {
  const { syncStatus, checkNow } = useCrawlerSync({
    enabled: true,
    interval: 10000, // 10 ç§’
    onNewData: (status) => {
      console.log(`å‘ç° ${status.newProductsCount} ä¸ªæ–°å•†å“`);
    },
  });

  return (
    <div>
      {syncStatus?.hasNewData && (
        <div>æœ‰æ–°æ•°æ®ï¼</div>
      )}
    </div>
  );
}
```

**é€‰é¡¹:**
- `enabled`: æ˜¯å¦å¯ç”¨è‡ªåŠ¨æ£€æµ‹ï¼ˆé»˜è®¤: trueï¼‰
- `interval`: æ£€æµ‹é—´éš”ï¼ˆæ¯«ç§’ï¼Œé»˜è®¤: 10000ï¼‰
- `onNewData`: å‘ç°æ–°æ•°æ®æ—¶çš„å›è°ƒå‡½æ•°

**è¿”å›å€¼:**
- `syncStatus`: å½“å‰åŒæ­¥çŠ¶æ€
- `isChecking`: æ˜¯å¦æ­£åœ¨æ£€æŸ¥
- `checkNow`: æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
- `resetLastCheck`: é‡ç½®æœ€åæ£€æŸ¥æ—¶é—´

## æµ‹è¯•

### æµ‹è¯•åŒæ­¥åŠŸèƒ½
```bash
npm run test:sync
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
1. æ£€æŸ¥æœ€è¿‘çš„çˆ¬å–æ—¥å¿—
2. åˆ—å‡ºæœ€è¿‘æ·»åŠ çš„å•†å“
3. æµ‹è¯•åŒæ­¥ API æ˜¯å¦æ­£å¸¸å·¥ä½œ

### æ‰‹åŠ¨æµ‹è¯•æµç¨‹
1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨: `npm run dev`
2. æ‰“å¼€å•†å“åˆ—è¡¨: http://localhost:3000/products
3. åœ¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæ‰“å¼€çˆ¬è™«æ§åˆ¶å°: http://localhost:3000/admin/real-crawler
4. æ‰§è¡Œä¸€æ¬¡çˆ¬å–
5. è§‚å¯Ÿå•†å“åˆ—è¡¨æ˜¯å¦æ˜¾ç¤ºé€šçŸ¥æ¨ªå¹…
6. ç‚¹å‡»åˆ·æ–°æŸ¥çœ‹æ–°å•†å“

## é…ç½®

### è°ƒæ•´æ£€æµ‹é—´éš”
åœ¨ `app/products/page.tsx` ä¸­ä¿®æ”¹ï¼š
```typescript
const { syncStatus, checkNow } = useCrawlerSync({
  enabled: true,
  interval: 15000, // æ”¹ä¸º 15 ç§’
  onNewData: (status) => {
    // ...
  },
});
```

### è°ƒæ•´æ–°å•†å“æ ‡è®°æ—¶é—´
åœ¨ `components/features/product-card.tsx` ä¸­ä¿®æ”¹ï¼š
```typescript
const isNew = product.createdAt && 
  new Date(product.createdAt).getTime() > Date.now() - 48 * 60 * 60 * 1000; // æ”¹ä¸º 48 å°æ—¶
```

## æ€§èƒ½ä¼˜åŒ–

### 1. è½®è¯¢ä¼˜åŒ–
- ä½¿ç”¨ `since` å‚æ•°åªæŸ¥è¯¢æ–°æ•°æ®
- é™åˆ¶è¿”å›çš„è®°å½•æ•°é‡
- ä½¿ç”¨æ•°æ®åº“ç´¢å¼•åŠ é€ŸæŸ¥è¯¢

### 2. å‰ç«¯ä¼˜åŒ–
- ä½¿ç”¨ `silent` å‚æ•°é¿å…ä¸å¿…è¦çš„ loading çŠ¶æ€
- é˜²æŠ–å¤„ç†é¿å…é¢‘ç¹åˆ·æ–°
- ä½¿ç”¨ React Query ç¼“å­˜æ•°æ®

### 3. æœªæ¥æ”¹è¿›
- ä½¿ç”¨ WebSocket å®ç°çœŸæ­£çš„å®æ—¶æ¨é€
- ä½¿ç”¨ Server-Sent Events (SSE)
- é›†æˆ Supabase Realtime è®¢é˜…

## æ•…éšœæ’é™¤

### é—®é¢˜ 1: æ²¡æœ‰æ˜¾ç¤ºé€šçŸ¥æ¨ªå¹…
**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
2. ç¡®è®¤åŒæ­¥ API æ­£å¸¸å·¥ä½œ: `npm run test:sync`
3. æ£€æŸ¥çˆ¬å–æ˜¯å¦çœŸçš„æ·»åŠ äº†æ–°å•†å“

### é—®é¢˜ 2: æ–°å•†å“æ ‡ç­¾ä¸æ˜¾ç¤º
**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥å•†å“çš„ `created_at` å­—æ®µæ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ—¶é—´åˆ¤æ–­é€»è¾‘ï¼ˆ24 å°æ—¶å†…ï¼‰
3. åˆ·æ–°é¡µé¢é‡æ–°åŠ è½½æ•°æ®

### é—®é¢˜ 3: è‡ªåŠ¨è·³è½¬ä¸å·¥ä½œ
**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦é˜»æ­¢äº†è‡ªåŠ¨è·³è½¬
2. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯
3. ç¡®è®¤çˆ¬å–ç¡®å®æˆåŠŸï¼ˆproductsSaved > 0ï¼‰

## æœ€ä½³å®è·µ

1. **åˆç†è®¾ç½®æ£€æµ‹é—´éš”**: ä¸è¦å¤ªé¢‘ç¹ï¼ˆå¢åŠ æœåŠ¡å™¨è´Ÿæ‹…ï¼‰ï¼Œä¹Ÿä¸è¦å¤ªæ…¢ï¼ˆç”¨æˆ·ä½“éªŒå·®ï¼‰
2. **æä¾›æ‰‹åŠ¨åˆ·æ–°**: å§‹ç»ˆç»™ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°çš„é€‰é¡¹
3. **æ¸…æ™°çš„è§†è§‰åé¦ˆ**: ä½¿ç”¨åŠ¨ç”»å’Œé¢œè‰²çªå‡ºæ–°æ•°æ®
4. **ä¼˜é›…é™çº§**: å³ä½¿åŒæ­¥åŠŸèƒ½å¤±è´¥ï¼ŒåŸºæœ¬åŠŸèƒ½ä»å¯ç”¨
5. **æ—¥å¿—è®°å½•**: è®°å½•åŒæ­¥äº‹ä»¶ä¾¿äºè°ƒè¯•

## ç›¸å…³æ–‡ä»¶

- `hooks/use-crawler-sync.ts` - åŒæ­¥ Hook
- `app/api/crawl/sync/route.ts` - åŒæ­¥ API
- `app/products/page.tsx` - å•†å“åˆ—è¡¨é¡µé¢
- `app/admin/real-crawler/page.tsx` - çˆ¬è™«æ§åˆ¶å°
- `components/features/product-card.tsx` - å•†å“å¡ç‰‡ç»„ä»¶
- `scripts/test-sync.ts` - æµ‹è¯•è„šæœ¬
