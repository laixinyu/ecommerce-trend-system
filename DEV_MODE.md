# 开发模式说明

## 什么是开发模式？

开发模式允许你在不进行真实登录的情况下访问系统的所有功能，使用一个模拟的测试账号。这对于开发和测试非常有用，特别是当遇到认证问题时。

## 如何启用开发模式？

在 `.env.local` 文件中设置：

```bash
NEXT_PUBLIC_DEV_MODE=true
```

## 开发模式的特性

### 1. 绕过登录认证
- 不需要真实的 Supabase 账号
- 自动使用测试账号登录
- 可以直接访问所有受保护的页面

### 2. 测试账号信息
```
用户ID: dev-user-123
邮箱: dev@test.com
```

### 3. 视觉指示
- 页面右下角会显示黄色的 "🔓 开发模式已启用" 标签
- 控制台会输出开发模式日志

## 如何关闭开发模式？

### 方法 1：修改环境变量
在 `.env.local` 中设置：
```bash
NEXT_PUBLIC_DEV_MODE=false
```

### 方法 2：删除环境变量
直接删除或注释掉这一行：
```bash
# NEXT_PUBLIC_DEV_MODE=true
```

然后重启开发服务器：
```bash
npm run dev
```

## 注意事项

⚠️ **重要提醒**：

1. **仅用于开发环境**
   - 开发模式仅应在本地开发时使用
   - 绝对不要在生产环境启用

2. **安全风险**
   - 开发模式会完全绕过认证系统
   - 任何人都可以访问所有功能

3. **数据限制**
   - 使用开发模式时，某些需要真实用户数据的功能可能无法正常工作
   - API 调用仍然需要有效的 Supabase 连接

4. **重启服务器**
   - 修改 `.env.local` 后必须重启开发服务器才能生效

## 使用场景

### 适合使用开发模式的情况：
- ✅ 开发新功能时快速测试
- ✅ 遇到 Supabase 认证问题时临时绕过
- ✅ 演示系统功能给团队成员
- ✅ 调试前端界面和交互

### 不适合使用开发模式的情况：
- ❌ 测试认证流程
- ❌ 测试用户权限
- ❌ 生产环境部署
- ❌ 需要真实用户数据的功能测试

## 故障排除

### 开发模式没有生效？

1. **检查环境变量**
   ```bash
   # 确保 .env.local 中有这一行
   NEXT_PUBLIC_DEV_MODE=true
   ```

2. **重启开发服务器**
   ```bash
   # 停止服务器 (Ctrl+C)
   npm run dev
   ```

3. **清除浏览器缓存**
   - 打开开发者工具 (F12)
   - 右键点击刷新按钮
   - 选择"清空缓存并硬性重新加载"

4. **检查控制台**
   - 应该看到 "🔓 开发模式已启用" 的日志
   - 应该看到 "🔓 开发模式：使用测试账号 dev@test.com"

### 仍然被重定向到登录页？

- 确保环境变量名称正确：`NEXT_PUBLIC_DEV_MODE`（注意大小写）
- 确保值为字符串 `"true"`，不是布尔值
- 检查 middleware.ts 是否正确读取了环境变量

## 恢复正常认证

当你准备测试真实的认证流程时：

1. 关闭开发模式（设置为 `false` 或删除环境变量）
2. 重启开发服务器
3. 清除浏览器 Cookie
4. 访问 `/login` 进行正常登录

## 相关文件

- `.env.local` - 环境变量配置
- `middleware.ts` - 认证中间件
- `lib/auth/auth-context.tsx` - 认证上下文
- `components/dev-mode-banner.tsx` - 开发模式指示器
