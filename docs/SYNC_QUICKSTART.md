# 爬虫数据同步 - 快速开始

## 5 分钟快速体验

### 1. 启动开发服务器
```bash
npm run dev
```

### 2. 打开两个浏览器标签页

**标签页 1 - 商品列表:**
```
http://localhost:3000/products
```

**标签页 2 - 爬虫控制台:**
```
http://localhost:3000/admin/real-crawler
```

### 3. 执行爬取任务

在爬虫控制台中：
1. 选择平台: `Amazon` 或 `AliExpress`
2. 输入关键词: 例如 `wireless earbuds`
3. 输入分类 ID: 从数据库获取（或使用测试 ID）
4. 设置爬取页数: `2`
5. 点击 **"开始爬取"**

### 4. 观察自动同步

爬取完成后：
- ✅ 自动跳转到商品列表
- ✅ 显示绿色通知横幅
- ✅ 新商品带有 "🆕 新品" 标签
- ✅ 每 10 秒自动检测新数据

## 功能演示

### 通知横幅
```
┌─────────────────────────────────────────────────┐
│ 🎉 发现 15 个新商品！                            │
│ 爬虫已完成数据采集，点击刷新查看最新商品          │
│                          [立即刷新] [稍后]       │
└─────────────────────────────────────────────────┘
```

### 新商品标记
```
┌──────────────┐
│ 🆕 新品      │  ← 24小时内的商品
│              │
│   商品图片    │
│              │
│ 强烈推荐     │  ← 推荐标签
└──────────────┘
```

## 测试命令

### 测试同步功能
```bash
npm run test:sync
```

输出示例：
```
🔍 测试爬虫同步功能...

1️⃣ 检查最近的爬取日志:
✅ 找到 5 条最近的爬取日志
   1. amazon - completed - 15 个商品 (2025-10-29 10:30:00)
   2. aliexpress - completed - 12 个商品 (2025-10-29 10:25:00)

2️⃣ 检查最近添加的商品:
✅ 找到 27 个爬取的商品，最近 10 个:
   🆕 1. [amazon] Wireless Earbuds... (2025-10-29 10:30:15)
   🆕 2. [amazon] Bluetooth Headphones... (2025-10-29 10:30:12)

3️⃣ 测试同步 API:
✅ 同步 API 正常工作
   - 有新数据: 是
   - 新商品数量: 15
   - 最近爬取次数: 2

✨ 测试完成！
```

## 核心文件

```
ecommerce-trend-system/
├── hooks/
│   └── use-crawler-sync.ts          # 同步 Hook
├── app/
│   ├── products/
│   │   └── page.tsx                 # 商品列表（带同步）
│   ├── admin/
│   │   └── real-crawler/
│   │       └── page.tsx             # 爬虫控制台
│   └── api/
│       └── crawl/
│           └── sync/
│               └── route.ts         # 同步 API
├── components/
│   └── features/
│       └── product-card.tsx         # 商品卡片（带新品标记）
└── scripts/
    └── test-sync.ts                 # 测试脚本
```

## 工作流程

```
┌─────────────┐
│ 爬虫控制台   │
│ 开始爬取     │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 爬虫执行     │
│ 保存数据     │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 自动跳转     │
│ 到商品列表   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 同步检测     │  ◄─── 每 10 秒轮询
│ (Hook)      │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 显示通知     │
│ 横幅         │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 用户点击     │
│ 刷新         │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ 显示新商品   │
│ 带 🆕 标签   │
└─────────────┘
```

## 常见问题

### Q: 为什么没有显示通知横幅？
A: 确保：
1. 爬取确实添加了新商品
2. 商品列表页面正在运行
3. 浏览器控制台没有错误

### Q: 新品标签不显示？
A: 检查：
1. 商品的 `created_at` 字段
2. 是否在 24 小时内
3. 刷新页面

### Q: 如何调整检测间隔？
A: 在 `app/products/page.tsx` 中修改：
```typescript
const { syncStatus } = useCrawlerSync({
  interval: 150000, // 改为 15 秒
});
```

## 下一步

- 📖 阅读完整文档: [CRAWLER_SYNC.md](./CRAWLER_SYNC.md)
- 🔧 配置爬虫: [REAL_CRAWLER_GUIDE.md](../lib/crawler/REAL_CRAWLER_GUIDE.md)
- 🚀 部署到生产: [DEPLOYMENT_GUIDE.md](../DEPLOYMENT_GUIDE.md)
